<!doctype html>
<html>

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

	<title>reveal.js</title>

	<link rel="stylesheet" href="dist/reset.css">
	<link rel="stylesheet" href="dist/reveal.css">
	<link rel="stylesheet" href="dist/theme/tkrt.css" id="theme">
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css"
		integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">

	<!-- Theme used for syntax highlighted code -->
	<link rel="stylesheet" href="plugin/highlight/monokai.css" id="highlight-theme">
</head>

<body>
	<div class="reveal">
		<div class="slides">
			<section>
				<section data-markdown>
					<textarea data-template>
						# probe-rs
					</textarea>
				</section>
			</section>
			<!-- ABOUT ME -->
			<section>
				<section data-markdown>
					<textarea data-template>
						## About me
					</textarea>
				</section>
				<section data-markdown>
					<textarea data-template>
						- Image?
						- Noah HÃ¼sser <!-- .element: class="fragment" -->
						- Aka Yatekii <!-- .element: class="fragment" -->
						- Born Swiss <!-- .element: class="fragment" -->
						- BSc in EE & IT <!-- .element: class="fragment" -->
					</textarea>
				</section>
				<section data-markdown>
					<textarea data-template>
						- Logo
						- Some image?
						- Technokrat
					</textarea>
				</section>
				<section data-markdown>
					<textarea data-template>
						- Image of Throw/Lock
						- Ju Jitsu
					</textarea>
				</section>
			</section>
			<!-- WHAT IS PROBE RS-->
			<section>
				<section data-markdown>
					<textarea data-template>
						What is probe-rs?
					</textarea>
				</section>
				<section data-markdown>
					<textarea data-template>
						A debugging toolset and library for debugging embedded ARM and RISC-V targets on a separate host
					</textarea>
				</section>
			</section>
			<!-- WHAT IS THE PROBLEM WE ARE TRYING TO SOLVE? -->
			<section>
				<section>
					<style scoped>
						ul.chain {
							width: 100%;
							height: 100%;
							display: flex;
							flex-direction: column;
							align-items: center;
							justify-content: space-around;
							margin: 0;
						}

						ul.chain>li {
							width: 10em;
							height: 2.5em;
							margin-top: 0.5em;
							display: flex;
							align-items: center;
							justify-content: center;
						}

						ul.chain>li.arrow {
							font-size: 40px;
							margin: -0.5em;
							padding-top: 20px;
						}

						ul.chain>li.arrow>span {
							font-size: 60px;
							margin-top: -20px;
						}

						[data-id=ui] {
							background: #03738C;
						}

						[data-id=mi] {
							background: #0396A6;
						}

						[data-id=gdb] {
							background: #78BF30;
						}

						[data-id=stub] {
							background: #B0BF3B;
						}

						[data-id=target] {
							background: #BF6734;
						}

						[data-id=server] {
							background: #0396A6;
						}
					</style>
					<ul class="chain">
						<li data-id="ui">Host</li>
						<li class="arrow">USB&nbsp;&nbsp;<span>&#x2195;</span>&nbsp;&nbsp;ETH</li>
						<li data-id="mi">Probe</li>
						<li class="arrow">SWD&nbsp;&nbsp;<span>&#x2195;</span>&nbsp;&nbsp;JTAG</li>
						<li data-id="gdb">Target</li>
					</ul>
					<aside class="notes">
						- We can directly attach to the program running on the host.
						- Easy to do, many aweosme tools (VS, IntelliJ, VSCode, GDB)
					</aside>
				</section>
				<section data-markdown>
					<textarea data-template>
							## Target
							- TODO:
							- Image of target
							- An Embedded CPU
							- Different Architectures
							- Vendor Defined Behavior
							- Standardized Interface
						</textarea>
				</section>
				<section data-markdown>
					<textarea data-template>
						## Probe
						- TODO:
						- Image of probe
						- Proprietary Connector between Host and Target
						- Mostly Proprietary Host Interface
						- Standardized Target Interface
					</textarea>
				</section>
				<section data-markdown>
					<textarea data-template>
						## Host
						- TODO:
						- Image of host
						- Driver for the Probe
						- Driver for the Target Interface
					</textarea>
				</section>
			</section>
			<!-- BUT ARENT THERE OTHER TOOLS? YES BUT -->
			<section>
				<section>
					<h2>There is tools for that already!</h2>
					<div class="container">
						<div class="row">
							<div class="col-6">
								<ul>
									<li>Segger J-Link</li>
									<li>ST-Link</li>
									<li>CMSIS-DAP
										<ul>
											<li>Many variants</li>
										</ul>
									</li>
									<li>Blackmagic Probe</li>
									<li>...</li>
								</ul>
							</div>
							<div class="col-6">
								<ul>
									<li>Segger J-Link Tools</li>
									<li>ST-Link Utility</li>
									<li>stlink-tool</li>
									<li>pyOCD</li>
									<li>OpenOCD
										<ul>
											<li>Many variants</li>
										</ul>
									</li>
									<li>Custom Scripts & Programs</li>
									<li>...</li>
								</ul>
							</div>
						</div>
					</div>
					<aside class="notes">
						Yes but!
					</aside>
				</section>
				<section data-markdown>
					<textarea data-template>
						## Yes but!

						Note:
						- Doing embedded for 7 years.
						- Always Eclipse & GDB based.
						- Every manufacturer with their own flavor.
						- Plenty of tools with awesome features that are not compatible with each other.
						- Tried to use VSCode & GDB in January 2019.
						- Huge pain with no success.
						- Conclusion: Ecosystem did not move an inch.
						- Embedded development should be fun!
					</textarea>
				</section>
				<style scoped>
					ul.debug-chain {
						width: 100%;
						height: 100%;
						display: flex;
						flex-direction: column;
						align-items: center;
						justify-content: space-around;
						margin: 0;
					}

					ul.debug-chain>li {
						width: 10em;
						height: 2.5em;
						margin-top: 0.5em;
						display: flex;
						align-items: center;
						justify-content: center;
					}

					[data-id=ui] {
						background: #03738C;
					}

					[data-id=mi] {
						background: #0396A6;
					}

					[data-id=gdb] {
						background: #78BF30;
					}

					[data-id=stub] {
						background: #B0BF3B;
					}

					[data-id=target] {
						background: #BF6734;
					}

					[data-id=server] {
						background: #0396A6;
					}
				</style>
				<section data-markdown>
					<textarea data-template>
						## The traditional setup
					</textarea>
				</section>
				<section>
					<ul class="debug-chain">
						<li data-id="ui" class="d-none">UI</li>
						<li data-id="mi" class="d-none">MI</li>
						<li data-id="gdb">GDB</li>
						<li data-id="stub" class="d-none">STUB</li>
						<li data-id="target">TARGET</li>
					</ul>
					<aside class="notes">
						- We can directly attach to the program running on the host.
						- Easy to do, many aweosme tools (VS, IntelliJ, VSCode, GDB)
					</aside>
				</section>
				<section>
					<ul class="debug-chain">
						<li data-id="ui" class="d-none">UI</li>
						<li data-id="mi" class="d-none">MI</li>
						<li data-id="gdb">GDB</li>
						<li data-id="stub">STUB</li>
						<li data-id="target">TARGET</li>
					</ul>
					<aside class="notes">
						- Now we want to debug on a remote target.
						- We need a GDB server, called stub.
						- Weird old serial protocol with lots of extensions and terrible docs.
						- One giant gdb.c as source of truth.
					</aside>
				</section>
				<section>
					<ul class="debug-chain">
						<li data-id="ui">UI</li>
						<li data-id="mi">MI</li>
						<li data-id="gdb">GDB</li>
						<li data-id="stub">STUB</li>
						<li data-id="target">TARGET</li>
					</ul>
					<aside class="notes">
						- We are trying to fit in a UI.
						- GDB adds the MI (machine interface) for that.
						- Suboptimal interface.
						- We don't even fit in the code editor here.
						- Can ofc be the same as the editor. Preferably moreso.
					</aside>
				</section>
				<section data-markdown>
					<textarea data-template>
						## What if
					</textarea>
				</section>
				<section>
					<ul class="debug-chain">
						<li data-id="ui">UI</li>
						<li data-id="server" style="height: 8.5em;">SERVER</li>
						<li data-id="target">TARGET</li>
					</ul>
					<aside class="notes">
						- We get rid of all the intermediate things and directly implement a server in the debugger.
						- Microsoft DAP!
						- VSCode
						- VS
						- Vim
						- Atom
						- IntelliJ?
						- ...
					</aside>
				</section>
				<section data-markdown>
					<textarea data-template>
						## The optimal solution

						- Editor of your choice
						- Debugger of your choice
						- Open API to be extendable
						- Rust friendly but language-agnostic
						- Project Encourages Contribution

						Note:
						- VSCode is a must for me
						- GDB is an absolute no-go.
							- Featureset nice.
							- Useability not nice.
							- Not interactive.
							- Old protocols.
						- OpenOCD is not optimal.
							- Huge & nice featureset.
							- Contribution discouraged.
							- Code is organically grown and lots of functionality is in scripts.
							- Setup is terrible.
								- People copy paste configs.
								- Nobody knows how things work.
							- Programmatic use is not so nice.
						- We want everything integrated into cargo.
					</textarea>
				</section>
				<section>
					<figure>
						<img src=" https://imgs.xkcd.com/comics/standards.png">
						<figcaption style="font-size: 0.4em;">source: https://xkcd.com/927/</figcaption>
					</figure>

					<aside class="notes">
						- Pretty much everyone knows this xkcd
						- This is in fact a problem we are trying to not neglect
						- Not only because of compatibility but also because of the project size
						- Using existing standards from ARM and Microsoft
						- Before we continue to the HOW let me show you what we can do as of now.
					</aside>
				</section>
			</section>
			<!-- WHAT CAN PROBE RS ALREADY DO? -->
			<section>
				<section data-markdown>
					## A small example.
					### Let us
					- Flash a program that counts up.
					- Reset and halt the CPU.
					- Set a breakpoint whenever the counter is increased.
					- Wait for the CPU halt.
					- Read the counter.
					- Continue.
				</section>
				<section data-markdown>
					<textarea data-template>
						Let us open a new `Session` and attach to core 0.
						```rust
						use probe_rs::Session;
						use probe_rs::MemoryInterface;

						let mut session = Session::auto_attach("nrf52")?;
						```
					</textarea>
				</section>
				<section data-markdown>
					<textarea data-template>
						Flash our ELF binary.
						```rust [6-10]
						use probe_rs::Session;
						use probe_rs::MemoryInterface;

						let mut session = Session::auto_attach("nrf52")?;

						probe_rs::flashing::download_file(
							&mut session,
							"./path/to/counter.elf",
							Format::Elf
						)?;
						```
					</textarea>
				</section>
				<section data-markdown>
					<textarea data-template>
						Reset the core and halt it.
						```rust [12-15]
						use probe_rs::Session;
						use probe_rs::MemoryInterface;

						let mut session = Session::auto_attach("nrf52")?;

						probe_rs::flashing::download_file(
							&mut session,
							"./path/to/counter.elf",
							Format::Elf
						)?;

						let timeout = std::time::Duration::from_millis(500);
						let mut core = session.core(0)?;
						
						core.reset_and_halt(timeout)?;			
						```
					</textarea>
				</section>
				<section data-markdown>
					<textarea data-template>
						Set a breakpoint at the corresponding flash address.
						```rust [6]
						let timeout = std::time::Duration::from_millis(500);
						let mut core = session.core(0)?;
						
						core.reset_and_halt(timeout)?;

						core.set_breakpoint(0x0000_0042)?;				
						```
					</textarea>
				</section>
				<section data-markdown>
					<textarea data-template>
						Loop and read the counter.
						```rust [8-12]
						let timeout = std::time::Duration::from_millis(500);
						let mut core = session.core(0)?;
						
						core.reset_and_halt(timeout)?;

						core.set_breakpoint(0x0000_0042)?;

						loop {
							core.run()?;
							core.wait_for_core_halted(timeout)?;
							core.read_word_32(0x2000_1337)?;
						}					
						```
					</textarea>
				</section>
				<section data-markdown>
					<textarea data-template>
						We have control over the entire CPU.

						Note:
						- This enables us to create any other tool that does magic.
						- The user should never care about what architecture they use.
							- Halting, running, etc. the core is always the same!
							- The API should be intuitive and fun to use.
						- So how do we achieve all of this?
					</textarea>
				</section>
			</section>
			<!-- HOW DOES IT DO IT? TODO:-->
			<section>
				<section data-markdown>
					<textarea data-template>
						## probe-rs structure
					</textarea>
				</section>
				<style scoped>
					div.row>div>div {
						margin-top: 0.5em;
						height: 2em;
						padding-top: 0.3em;
						vertical-align: middle;
					}

					.application>div>div {
						background: #03738C;
					}

					.external-lib>div>div {
						background: #0396A6;
					}

					.session>div>div {
						background: #78BF30;
					}

					.core>div>div {
						background: #B0BF3B;
					}

					.probe>div>div {
						background: #BF6734;
					}
				</style>
				<section>
					<div class="container probe-rs-structure align-middle">
						<div class="row mb-2 application">
							<div class="col-4">
								<div>cargo-flash</div>
							</div>
							<div class="col-4">
								<div>cargo-embed</div>
							</div>
							<div class="col-4">
								<div>vscode</div>
							</div>
						</div>
						<div class="row mb-2 external-lib">
							<div class="col-4">
								<div>probe-rs-rtt</div>
							</div>
							<div class="col-4">
								<div>GDB</div>
							</div>
							<div class="col-4">
								<div>Flashing</div>
							</div>
						</div>
						<div class="row mb-2 session">
							<div class="col-12">
								<div>Session</div>
							</div>
						</div>
						<div class="row mb-2 core">
							<div class="col-6">
								<div>Core</div>
							</div>
							<div class="col-6">
								<div>Target Description</div>
							</div>
						</div>
						<div class="row mb-2 probe">
							<div class="col-12">
								<div>Probe</div>
							</div>
						</div>
					</div>
				</section>
				<section>
					<img src="img/flash-algorithms.svg">
					<aside class="notes">
					</aside>
				</section>
				<section data-markdown>
					<textarea data-template>
						## CMSIS-DAP
					</textarea>
				</section>
				<section data-markdown>
					<textarea data-template>
						## CMSIS-Packs
					</textarea>
				</section>
			</section>
			<!-- WHAT DOES THE FUTURE LOOK LIKE? -->
			<section>
				<section data-markdown>
					<textarea data-template>
						## What is planned for the future?
					</textarea>
				</section>
				<section data-markdown>
					<textarea data-template>
						VSCode
						- Stacktrace
						- Stackframe
						- Basic controls
						- Status: Early alpha
					</textarea>
				</section>
				<section data-markdown>
					<textarea data-template>
						- ITM
						- Status: Around the corner (oxidize)
					</textarea>
				</section>
				<section data-markdown>
					<textarea data-template>
						Custom workflows
						- ARM Debug sequences
						- Status: Concept phase
					</textarea>
				</section>
				<section data-markdown>
					<textarea data-template>
						More stability
						- The more users the more bugs ;)
						- Speed improvements
						- Special case handling
						- Status: Reoccuring
					</textarea>
				</section>
				<section data-markdown>
					<textarea data-template>
						More graphical tools
						- An ITM & RTT tracer?
						- ETM tracer even?
						- Flash layout visualization?
						- Status: PoC in JS
					</textarea>
				</section>
				<section data-markdown>
					<textarea data-template>
						probe-rs-server
						- Concurrent use of probe-rs
						- Status: Being worked on
					</textarea>
				</section>
			</section>
			<!-- DEMO TIME -->
			<section data-markdown>
				<textarea data-template>
					## Demo time!
				</textarea>
			</section>
			<!-- OUR OWN PROBE -->
			<section>
				<section>
					<h2>hs_probe</h2>
					<img style="height: 10em;" src="img/hs-probe.png" />
				</section>
				<section data-markdown>
					<textarea data-template>
						## the facts
						- open source probe
						- pure rust firmware
						- extremely fast (500 Mbit/s)
						- uses standard ARM API
						- can stream DAP, ITM and UART data
					</textarea>
				</section>
				<section data-markdown>
					<textarea data-template>
						## Sign up for it
						TODO: URL
					</textarea>
				</section>
			</section>
			<!-- CONTRIBUTE -->
			<section>
				<section data-markdown>
					<textarea data-template>
						## Contribute!
						- https://probe.rs
						- https://github.com/probe-rs/probe-rs
						- [#probe-rs:matrix.org](https://matrix.to/#/#probe-rs:matrix.org) on Matrix
						- Questions & Bugreports very welcome
						- PRs even more welcome ;)
					</textarea>
				</section>
			</section>
		</div>
	</div>

	<script src="dist/reveal.js"></script>
	<script src="plugin/notes/notes.js"></script>
	<script src="plugin/markdown/markdown.js"></script>
	<script src="plugin/highlight/highlight.js"></script>
	<script>
		// More info about initialization & config:
		// - https://revealjs.com/initialization/
		// - https://revealjs.com/config/
		Reveal.initialize({
			hash: true,

			// Learn about plugins: https://revealjs.com/plugins/
			plugins: [RevealMarkdown, RevealHighlight, RevealNotes],
		});
	</script>
</body>

</html>